name: Discord Release

on:
  release:
    types: [published]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord notification
        env:
          WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          BODY: ${{ github.event.release.body }}
          TAG: ${{ github.event.release.tag_name }}
          URL: ${{ github.event.release.html_url }}
          REPO: ${{ github.repository }}
        run: |
          BODY_TRIM=$(echo "$BODY" | head -c 3900)
          curl -H "Content-Type: application/json" \
            -d "{
              \"embeds\": [{
                \"title\": \"ðŸš€ New Release: $TAG\",
                \"url\": \"$URL\",
                \"description\": \"$BODY_TRIM\",
                \"footer\": { \"text\": \"$REPO\" }
              }]
            }" \
            $WEBHOOK
